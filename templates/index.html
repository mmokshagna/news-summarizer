<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Summarizer</title>
    <script>
        const storedTheme = localStorage.getItem("theme");
        if (
            storedTheme === "dark" ||
            (!storedTheme && window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
            document.documentElement.classList.add("dark");
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 min-h-screen">
    <div id="loadingSpinner" class="fixed inset-0 bg-black/30 dark:bg-black/50 hidden items-center justify-center z-50">
        <div class="h-16 w-16 border-4 border-white/70 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div class="max-w-3xl mx-auto px-4 py-10 space-y-6">
        <header class="flex items-center justify-between">
            <div>
                <p class="text-sm uppercase tracking-wide text-indigo-500 font-semibold">Smart Summarizer</p>
                <h1 class="text-3xl font-bold mt-1">AI-Powered News Summaries</h1>
                <p class="text-sm text-gray-600 dark:text-gray-300">Summarize, translate, and analyze sentiment in one place.</p>
            </div>
            <button id="themeToggle" type="button" class="relative inline-flex h-9 w-16 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors">
                <span class="sr-only">Toggle dark mode</span>
                <span id="themeThumb" class="inline-block h-7 w-7 transform rounded-full bg-white shadow-md transition-transform translate-x-1 dark:translate-x-8"></span>
            </button>
        </header>

        <main class="space-y-6">
            <div class="bg-white dark:bg-gray-800 shadow-md rounded-xl p-6 space-y-4">
                <form id="summarizeForm" action="{{ url_for('summarize') }}" method="post" class="space-y-4">
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <label for="text" class="text-sm font-semibold text-gray-800 dark:text-gray-100">Enter text to summarize</label>
                            <div class="text-xs text-gray-500 dark:text-gray-300 flex gap-3">
                                <span id="charCount">0 characters</span>
                                <span id="wordCount">0 words</span>
                            </div>
                        </div>
                        <textarea
                            id="text"
                            name="text"
                            required
                            class="w-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4 min-h-[220px] focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="Paste or type your text here..."
                        >{{ original_text }}</textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label for="summary_type" class="block text-sm font-semibold text-gray-800 dark:text-gray-100">Summary type</label>
                            <select
                                id="summary_type"
                                name="summary_type"
                                class="w-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                                <option value="short" {% if selected_summary == 'short' %}selected{% endif %}>Short Summary (1â€“2 sentences)</option>
                                <option value="detailed" {% if selected_summary == 'detailed' %}selected{% endif %}>Detailed Summary</option>
                                <option value="bullet" {% if selected_summary == 'bullet' %}selected{% endif %}>Bullet Point Summary</option>
                                <option value="kid" {% if selected_summary == 'kid' %}selected{% endif %}>Kid-Friendly Summary</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label for="target_language" class="block text-sm font-semibold text-gray-800 dark:text-gray-100">Target language</label>
                            <select
                                id="target_language"
                                name="target_language"
                                class="w-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                                <option value="English" {% if selected_language == 'English' %}selected{% endif %}>English</option>
                                <option value="Spanish" {% if selected_language == 'Spanish' %}selected{% endif %}>Spanish</option>
                                <option value="Hindi" {% if selected_language == 'Hindi' %}selected{% endif %}>Hindi</option>
                                <option value="Telugu" {% if selected_language == 'Telugu' %}selected{% endif %}>Telugu</option>
                                <option value="French" {% if selected_language == 'French' %}selected{% endif %}>French</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex flex-wrap items-center justify-between gap-3">
                        <label for="sentiment" class="flex items-center gap-3 text-sm font-medium text-gray-800 dark:text-gray-100">
                            <input
                                type="checkbox"
                                id="sentiment"
                                name="sentiment"
                                class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-700"
                                {% if sentiment_enabled %}checked{% endif %}
                            />
                            Include sentiment analysis (positive / neutral / negative)
                        </label>
                        <button
                            type="submit"
                            class="inline-flex items-center justify-center gap-2 rounded-lg bg-indigo-600 text-white px-5 py-2.5 font-semibold shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m-7 4h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H9.5L5 8.5V20a2 2 0 0 0 2 2h1Z" />
                            </svg>
                            Summarize
                        </button>
                    </div>
                </form>
            </div>

            <div class="bg-white dark:bg-gray-800 shadow-md rounded-xl p-6 space-y-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold">Summary</h2>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Your AI-generated result appears here.</p>
                    </div>
                    {% if summary %}
                    <button
                        id="copySummary"
                        type="button"
                        class="inline-flex items-center gap-2 rounded-lg border border-gray-200 dark:border-gray-700 px-4 py-2 text-sm font-semibold text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m-7 4h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H9.5L5 8.5V20a2 2 0 0 0 2 2h1Z" />
                        </svg>
                        Copy Summary
                    </button>
                    {% endif %}
                </div>
                {% if summary %}
                <div class="prose prose-indigo dark:prose-invert max-w-none" id="summaryText">
                    <p>{{ summary }}</p>
                </div>
                {% else %}
                <p class="text-sm text-gray-600 dark:text-gray-300">Run a summary to see the results displayed here.</p>
                {% endif %}

                {% if sentiment %}
                <div class="mt-3 rounded-lg border border-indigo-100 dark:border-indigo-700/60 bg-indigo-50 dark:bg-indigo-900/40 px-4 py-3 text-sm font-medium text-indigo-900 dark:text-indigo-100">
                    Sentiment: {{ sentiment }}
                </div>
                {% endif %}
            </div>
        </main>
    </div>

    <script>
        const textArea = document.getElementById("text");
        const charCount = document.getElementById("charCount");
        const wordCount = document.getElementById("wordCount");
        const summarizeForm = document.getElementById("summarizeForm");
        const loadingSpinner = document.getElementById("loadingSpinner");
        const copyButton = document.getElementById("copySummary");
        const summaryContent = document.getElementById("summaryText");
        const themeToggle = document.getElementById("themeToggle");

        function updateCounts() {
            const text = textArea.value || "";
            charCount.textContent = `${text.length} characters`;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            wordCount.textContent = `${words} word${words === 1 ? "" : "s"}`;
        }

        function showSpinner() {
            if (loadingSpinner) {
                loadingSpinner.classList.remove("hidden");
                loadingSpinner.classList.add("flex");
            }
        }

        function hideSpinner() {
            if (loadingSpinner) {
                loadingSpinner.classList.add("hidden");
                loadingSpinner.classList.remove("flex");
            }
        }

        function initializeTheme() {
            const isDark = document.documentElement.classList.contains("dark");
            themeToggle.setAttribute("aria-pressed", String(isDark));
        }

        if (textArea) {
            updateCounts();
            textArea.addEventListener("input", updateCounts);
        }

        if (summarizeForm) {
            summarizeForm.addEventListener("submit", () => {
                showSpinner();
            });
        }

        window.addEventListener("pageshow", () => hideSpinner());

        if (copyButton && summaryContent) {
            copyButton.addEventListener("click", async () => {
                const textToCopy = summaryContent.innerText.trim();
                if (!textToCopy) return;
                try {
                    await navigator.clipboard.writeText(textToCopy);
                    copyButton.textContent = "Copied!";
                    setTimeout(() => (copyButton.textContent = "Copy Summary"), 1600);
                } catch (error) {
                    console.error("Copy failed", error);
                }
            });
        }

        if (themeToggle) {
            themeToggle.addEventListener("click", () => {
                const isDark = document.documentElement.classList.toggle("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
                initializeTheme();
            });
            initializeTheme();
        }
    </script>
</body>
</html>
